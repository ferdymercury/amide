; Script generated by the Inno Setup Script Wizard.
; SEE THE DOCUMENTATION FOR DETAILS ON CREATING INNO SETUP SCRIPT FILES!
#define package @PACKAGE@
#define version @VERSION@
#define build_path @BUILD_PATH@
#define source_path @SOURCE_PATH@
#define project_url @PROJECT_URL@
#define project_bugs @PROJECT_ISSUES_URL@

#define msys_path @MSYS_PATH@

[Setup]
AppName={#package}
AppVerName={#package}-{#version}-1
AppPublisher={#project_bugs}
AppPublisherURL={#project_url}
AppCopyright=Copyright (C) 2000-2023 {#package} contributors
AppSupportURL={#project_url}
AppUpdatesURL={#project_url}
DefaultDirName={pf}\{#package}
DefaultGroupName={#package}
AllowNoIcons=yes
LicenseFile={#build_path}\COPYING
OutputBaseFileName={#package}-{#version}-1_install
OutputDir=Inno_Output
ChangesAssociations=yes

[Tasks]
Name: "desktopicon"; Description: "Create a &desktop icon"; GroupDescription: "Additional icons:"

[Registry]
; This adds the dll's in the bin directory to amide.exe's path
Root: HKLM; Subkey: "Software\Microsoft\Windows\CurrentVersion\App Paths\{#package}.exe"; Flags: uninsdeletekeyifempty
Root: HKLM; Subkey: "Software\Microsoft\Windows\CurrentVersion\App Paths\{#package}.exe"; ValueType: string; ValueData: "{app}\bin\{#package}.exe"; Flags: uninsdeletevalue
Root: HKLM; Subkey: "Software\Microsoft\Windows\CurrentVersion\App Paths\{#package}.exe"; ValueType: string; ValueName: "Path"; ValueData: "{app};{app}\bin"; Flags: uninsdeletevalue

; This allows .xif files to get sent to AMIDE
Root: HKCR; Subkey: ".xif"; ValueType: string; ValueName: ""; ValueData: "AmideXmlImageFormat"; Flags: uninsdeletevalue
Root: HKCR; Subkey: "AmideXmlImageFormat"; ValueType: string; ValueName: ""; ValueData: "amide"; Flags: uninsdeletekey
Root: HKCR; Subkey: "AmideXmlImageFormat\DefaultIcon"; ValueType: string; ValueName: ""; ValueData: "{app}\bin\AMIDE.EXE,1"
Root: HKCR; Subkey: "AmideXmlImageFormat\shell\open\command"; ValueType: string; ValueName: ""; ValueData: """{app}\bin\AMIDE.EXE"" ""%1"""



[Files]
Source: "{#build_path}\src\*.exe"; DestDir: "{app}\bin"; Flags: ignoreversion
Source: "{#msys_path}\bin\*"; DestDir: "{app}\bin"; Flags: ignoreversion
; Source: "{#msys_path}\help\*"; DestDir: "{app}\help\"; Flags: ignoreversion recursesubdirs
Source: "{#msys_path}\etc\*"; DestDir: "{app}\etc"; Flags: ignoreversion recursesubdirs
Source: "{#msys_path}\lib\*"; DestDir: "{app}\lib"; Flags: ignoreversion recursesubdirs
; Source: "{#msys_path}\man\*"; DestDir: "{app}\man"; Flags: ignoreversion recursesubdirs
Source: "{#msys_path}\share\*"; DestDir: "{app}\share"; Flags: ignoreversion recursesubdirs
; NOTE: Don't use "Flags: ignoreversion" on any shared system files

[Icons]
Name: "{group}\amide"; Filename: "{app}\bin\amide.exe";
Name: "{userdesktop}\amide"; Filename: "{app}\bin\amide.exe"; Tasks: desktopicon
